### 控制图概述

控制图（Control Chart），也称为管制图或Shewhart控制图，是质量控制（Quality Control，简称QC）领域中最核心的统计工具之一。它是QC七大工具（也称初级统计工具）中的关键组成部分，由美国贝尔实验室的沃尔特·A·休哈特（Walter A. Shewhart）于1924年发明，主要用于监测生产或服务过程的稳定性，区分正常变异（Common Cause Variation）和异常变异（Special Cause Variation）。

控制图的核心原理基于统计假设检验：当过程处于统计控制状态（In Control）时，数据点应随机分布在控制限内；一旦出现异常模式，则表明过程可能失控（Out of Control），需要调查和干预。该工具广泛应用于制造业、服务业、实验室质量管理和软件过程改进等领域。

#### 控制图的基本结构
一个典型的控制图包括以下要素：
- **横轴**：时间顺序或样本序号。
- **纵轴**：质量特性值（例如尺寸、重量、缺陷率等）。
- **中心线（CL）**：过程平均值，通常基于历史数据计算。
- **上控制限（UCL）和下控制限（LCL）**：通常设定为CL ± 3σ（σ为过程标准差），概率上对应99.73%的置信水平（假设正态分布）。
- **数据点**：按时间顺序绘制的实际测量值。

#### 控制图的主要类型
控制图根据数据性质分为两大类：

1. **变量控制图**（适用于连续测量数据，如长度、温度）：
   - X-bar图（平均值图）：监控子组平均值。
   - R图（极差图）：监控子组内变异。
   - S图（标准差图）：监控子组内变异（适用于大子组）。
   - I-MR图（个体-移动极差图）：适用于单个测量值。

2. **属性控制图**（适用于计数数据，如缺陷数、合格率）：
   - p图：监控不合格品比率。
   - np图：监控不合格品数量。
   - c图：监控缺陷总数。
   - u图：监控单位缺陷数。

#### 异常判断规则
控制图不仅仅是绘图工具，还需结合规则判断失控信号。最常用的是：
- **Shewhart基本规则**：单个点超出UCL或LCL。
- **Western Electric规则**（或称Nelson规则）：检测趋势、周期等模式，例如：
  - 连续7点在中心线同一侧。
  - 连续6点单向递增或递减。
  - 连续2点中至少3点在2σ限外。
  - 连续4点中至少5点在2σ限外。

这些规则可有效识别非随机模式，提高对异常的敏感度。

### 从工具开发角度的设计与开发

从软件工具开发者的视角，设计和实现控制图功能需要兼顾统计准确性、用户体验、性能和可扩展性。以下是关键设计要点：

#### 1. 数据模型与输入设计
- 支持多种数据格式：CSV、Excel、数据库查询或实时API。
- 定义关键参数：质量特性类型（变量/属性）、子组大小（n，通常为4-6）、时间戳或序号。
- 提供基线数据阶段（Phase I）和监控阶段（Phase II）的区分：Phase I用于计算初始控制限，Phase II用于持续监控。

#### 2. 统计计算核心
- **控制限计算**：基于历史数据（至少20-30个子组）计算CL、UCL、LCL。需实现多种公式，例如：
  - X-bar & R图：UCL = X-bar + A₂R-bar，LCL = X-bar - A₂R-bar（A₂为常数表）。
  - p图：UCL = p-bar + 3√(p-bar(1-p-bar)/n)。
- 支持动态重计算：用户可选择排除异常点后重新计算限值。
- 实现多种规则引擎：可配置启用Western Electric、Nelson或自定义规则。

#### 3. 图形渲染与交互
- 使用成熟图表库：Python（Matplotlib/Plotly）、JavaScript（Chart.js/D3.js）、R（ggplot2）。
- 交互功能：
  - 鼠标悬停显示点值、规则触发信息。
  - 支持缩放、平移、导出（PNG/PDF）。
  - 异常点高亮（红色标记）并弹出警报。
- 实时更新：集成WebSocket或轮询机制，实现生产现场监控。

#### 4. 异常检测与警报机制
- 开发规则引擎模块：遍历数据点，应用多条规则，返回失控信号列表。
- 集成通知系统：邮件、短信或系统内消息。
- 支持过程能力指数（Cp/Cpk）联动：计算并显示在图表旁。

#### 5. 性能与扩展性考虑
- 大数据处理：对于海量数据，使用分批计算或采样。
- 多图表支持：允许同时监控多个特性。
- 国际化与合规：支持中英文界面，符合ISO 7870-2（控制图标准）。

#### 6. 测试与验证
- 单元测试：验证控制限计算准确性。
- 模拟测试：注入异常模式，检查规则触发率。
- 用户验证：确保界面直观，操作符合质量工程师习惯。

通过以上设计，控制图工具不仅能实现基本功能，还能成为质量管理系统的核心模块，支持从数据采集到决策的全流程闭环。实际开发中，可参考Minitab、QI Macros或开源库如Python的statsmodels和matplotlib进行原型验证。

**控制图**在最常见和最基础的应用场景中，确实**主要基于单维（univariate）数据**，即针对**一个质量特性（一个测量维度）**的连续测量值序列进行监控。但这并非控制图的全部形态，下面从概念、数据要求和实际应用角度进行精确说明。

### 1. 经典控制图（Shewhart控制图）属于单维数据监控
大多数人日常接触和使用的控制图（如X-bar & R、X-bar & S、I-MR、p、np、c、u等）均为**单变量控制图（Univariate Control Chart）**，其核心特点是：

- **输入数据**：针对**单一质量特性**（single quality characteristic）的测量序列。
- **数据形式**：
  - **连续型（变量数据）**：长度、直径、重量、温度、电压、硬度等数值。
  - **离散型（属性数据）**：不合格品数、不合格率、缺陷数、单位缺陷数。
- **时间序列特性**：要求数据按生产顺序（或抽样顺序）连续采集，形成**有序的单列数值序列**。
- **监控目标**：判断该单一特性的**过程均值**（或比例、计数水平）和**过程变异**是否处于统计控制状态。

因此，在常规QC实践中，您提到的表述——“**只需要给出工序的连续测量数据即可，属于单维数据**”——是**基本正确**的，尤其适用于以下情况：
- X-bar & R / X-bar & S 图（子组大小n≥2的连续测量）
- I-MR 图（子组大小n=1的单个连续测量）
- p / np / c / u 图（计数或比例数据）

### 2. 存在多变量控制图（Multivariate Control Chart）的情形
当一个工序或产品同时有**多个相互关联的质量特性**需要同时监控时，单纯使用多个独立的单变量控制图会产生误判（Type I错误率膨胀或遗漏相关性影响）。此时需采用**多变量控制图**，其本质上监控的是**多维向量**，而非单维数据。

常见多变量控制图包括：
- **Hotelling T² 控制图**（最经典的多变量Shewhart图）：同时监控多个相关变量的**均值向量**是否偏移。
- **多变量EWMA（MEWMA）** 或 **多变量CUSUM**：对小偏移更敏感。
- **广义方差图** 或 **MEWMA方差图**：监控协方差矩阵的稳定性。

**典型应用场景**（多维数据）：
- 注塑件同时监控**长度、宽度、厚度**（三维几何尺寸，通常相关）。
- 化学反应过程同时监控**温度、压力、浓度**。
- 食品加工同时监控**pH值、粘度、颜色指数**。
- 轴承同时监控**外径和内径**（两者高度相关）。

在这些场景中，**输入不再是单一列连续数据，而是多列（向量）数据**，且必须考虑变量间的**协方差/相关性**。如果忽略相关性而分别画单变量控制图，可能导致：
- 虚假报警增多（每个图独立判断，整体α风险累加）。
- 真正失控（相关结构改变）却未被单个图检测到。

### 3. 总结判断表

| 场景描述                              | 是否单维数据 | 推荐控制图类型          | 输入数据本质                  | 备注                                   |
|---------------------------------------|--------------|---------------------------|-------------------------------|----------------------------------------|
| 监控单一特性（如直径、温度、缺陷率）   | 是           | X-bar & R / I-MR / p图等   | 单列连续测量序列              | 最常见、最基础的应用                   |
| 多个特性，但彼此独立无关               | 是           | 分别画多个单变量控制图     | 多列，但各列独立              | 可行，但管理多个图表较繁琐             |
| 多个特性，且存在相关性（共变）         | 否           | 多变量控制图（T²、MEWMA等）| 多列相关向量数据              | 必须考虑协方差矩阵，否则判断失真       |
| 高维特性（>10个变量）                  | 否           | 多变量 + 降维（PCA + T²）  | 高维向量                      | 传统多变量图敏感度下降，需结合主成分分析 |

### 结论
- **大多数常规控制图应用**（尤其是制造业日常SPC）确实**只需提供工序的连续单维测量数据**，属于**单维数据监控**。
- 但当质量特性**不止一个**且**相互关联**时，控制图扩展为**多维形式**，输入变为**多变量向量序列**，不再是严格的单维数据。

若您的具体工序或产品只涉及**一个主要监控特性**（绝大多数现场情况如此），则**“给出工序的连续测量数据即可，属于单维数据”**这一理解是准确且充分的。若涉及多个相关特性，建议评估是否需要转向多变量控制图以获得更可靠的过程判断。

如您有具体的工序特性列表（例如同时监控哪些参数），我可进一步帮助判断应采用单变量还是多变量方案。
